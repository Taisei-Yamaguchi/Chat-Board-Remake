(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[444],{4941:function(e,t,r){Promise.resolve().then(r.bind(r,2694))},2694:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var n=r(7437),o=r(2265),a=r(1841),s=r(4410),i=r(102),l=r(644);let c=async(e,t)=>await fetch("".concat(l.S,"/board/comment/hide/").concat(e),{method:"PATCH",headers:{"content-type":"application/json",Authorization:"Token ".concat(t)},body:JSON.stringify({})});var d=r(7907),u=r(2251),m=e=>{let{comment_id:t}=e,r=(0,d.useRouter)(),o=(0,a.TL)(),s=(0,a.CG)(e=>e.loginUserSlice.account),l=(0,a.CG)(e=>e.loginUserSlice.token),m=async()=>{if(!s||!l)return r.push("/login");try{o((0,u.NH)(!0)),await c(t,l)}catch(e){console.error("Error fetching data:",e)}finally{o((0,u.NH)(!1))}};return(0,n.jsx)("button",{onClick:m,children:(0,n.jsx)(i.sUl,{})})},h=r(6674),g=e=>{let{comment:t,boardAccountId:r}=e,o=(0,a.TL)(),s=(0,a.CG)(e=>e.loginUserSlice.account),i=new Date(t.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),l=e=>{o((0,h.VH)(e))};return(0,n.jsx)("li",{className:"flex flex-row justify-between p-1 w-full",children:(0,n.jsxs)("div",{className:"text-sm flex-col w-full border border-slate-300",children:[(0,n.jsxs)("div",{className:"flex w-full ",children:[(0,n.jsxs)("div",{className:"mx-2",children:[t.id,":"]}),(0,n.jsxs)("div",{className:"text-xs flex w-1/3 max-sm:w-full justify-between",children:[(0,n.jsxs)("button",{className:"flex link link-hover",onClick:()=>l(t.id),children:[t.account.id===r?(0,n.jsx)("div",{className:"text-green-600",children:"うぷ主:"}):(0,n.jsx)("div",{className:"text-orange-400",children:"名無しさん(仮):"}),i]}),s&&t.account&&s.id===t.account.id?(0,n.jsx)(m,{comment_id:t.id}):(0,n.jsx)(n.Fragment,{})]})]}),t.reply_to_comment&&(0,n.jsxs)("div",{children:["＞＞",t.reply_to_comment]}),t.image_url&&(0,n.jsx)("img",{src:t.image_url,className:"h-40"}),t.content&&(0,n.jsx)("div",{children:t.content})]})})},f=r(2840),x=r(8641),p=e=>{let{boardTitle:t,boardAccountId:r,comments:a}=e,s=(0,o.useRef)(null);(0,o.useEffect)(()=>{i()},[a]);let i=()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)};return(0,n.jsxs)("div",{ref:s,className:"fixed top-14 left-0 xl:max-h-[500px] max-xl:max-h-[500px] max-lg:max-h-[400px] max-sm:max-h-[390px] w-full bg-gradient-to-r from-gray-200 to-white z-0  overflow-y-auto",children:[(0,n.jsx)("button",{onClick:()=>{s.current&&(s.current.scrollTop=0)},className:"overflow-visible z-50  fixed bottom-14 right-4 bg-gray-300 hover:bg-gray-400 text-xs text-black font-bold py-2 px-4 rounded",children:(0,n.jsx)(x.y02,{size:15})}),(0,n.jsx)("button",{onClick:i,className:"z-50  fixed bottom-4 right-4 bg-gray-300 hover:bg-gray-400 text-xs text-black font-bold py-2 px-4 rounded",children:(0,n.jsx)(x.IMj,{size:15})}),(0,n.jsx)("button",{onClick:()=>{window.location.reload()},className:"z-50 fixed bottom-24 right-4 bg-gray-300 hover:bg-gray-400 text-xs text-black font-bold py-2 px-4 rounded",children:(0,n.jsx)(f.A$d,{size:15})}),(0,n.jsx)("div",{className:"fixed top-18 bg-gradient-to-r from-gray-200 to-white w-full text-sm",children:t}),a&&(0,n.jsx)(n.Fragment,{children:a.length>0?(0,n.jsx)("ul",{className:"flex flex-col items-center h-full m-2 mt-10 mb-30",children:a.map((e,t)=>(0,n.jsx)(g,{comment:e,boardAccountId:r},t))}):(0,n.jsx)("div",{className:"flex flex-col justify-center items-center w-screen h-full",children:(0,n.jsx)("div",{className:"text-xl",children:"No Comments yet"})})})]})},y=r(9683),b=r(8693),j=r(1991),w=r(3167);let v=async(e,t,r)=>{try{return(await fetch("".concat(l.S,"/board/comment/create/").concat(e),{method:"POST",headers:{Authorization:"Token ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}catch(e){throw console.error("There has been a problem with your fetch operation: ",e),e}},N=async(e,t,r)=>{let n=new FormData;if(t.image){try{let e=await k(t.image);n.append("image",e)}catch(e){throw console.error("Failed to compress image: ",e),e}try{return(await fetch("".concat(l.S,"/board/comment-image/create/").concat(e),{method:"POST",headers:{Authorization:"Token ".concat(r)},body:n})).json()}catch(e){throw console.error("There has been a problem with your fetch operation: ",e),e}}},k=async e=>new Promise((t,r)=>{let n=document.createElement("canvas"),o=n.getContext("2d");if(!o){r(Error("Failed to get 2d rendering context"));return}let a=new Image;a.onload=()=>{let e=a.width,r=a.height;(e>1920||r>1080)&&(e>r?(r*=1920/e,e=1920):(e*=1080/r,r=1080)),n.width=e,n.height=r,o.drawImage(a,0,0,e,r);let s=.9,i=n.toDataURL("image/jpeg",s);for(;i.length>1048576&&s>.1;)s-=.1,i=n.toDataURL("image/jpeg",s);t(S(i))},a.onerror=e=>{r(Error("Failed to load image: ".concat(e)))},a.src=URL.createObjectURL(e)}),S=e=>{let t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),o=new Uint8Array(n);for(let e=0;e<t.length;e++)o[e]=t.charCodeAt(e);return new Blob([n],{type:r})};var C=e=>{let{board_id:t}=e,r=(0,d.useRouter)(),s=(0,a.TL)(),i=(0,a.CG)(e=>e.loginUserSlice.account),l=(0,a.CG)(e=>e.loginUserSlice.token),c=(0,a.CG)(e=>e.commentReplySlice.commentReply),m=()=>{s((0,h.VH)(null))},g=j.Ry().shape({content:j.Z_().max(1e3,"Content must be at most 1000 characters long").required("content is required!")}),[x,p]=(0,o.useState)({message:"",type:""}),y=(0,b.TA)({initialValues:{content:""},validationSchema:g,onSubmit:async e=>{try{if(s((0,u.NH)(!0)),i&&l){let r={...e,reply_to_comment:c};(await v(t,r,l)).error?p({message:"Failed to create board",type:"error"}):(p({message:"Succeeded to create board",type:"success"}),y.setValues({content:""}))}else r.push("/login")}catch(e){console.error("Post error:",e),p({message:"Failed to create snack",type:"error"})}finally{s((0,u.NH)(!1))}}});return(0,n.jsxs)("div",{className:" fixed bottom-0 left-0 border",children:[x.message&&(0,n.jsx)("div",{className:(0,w.Z)("fixed z-50 top-5 right-5 w-fit text-white text-lg px-5 py-3 rounded-md mb-5 ",{"bg-red-500":"error"===x.type}),children:x.message}),(0,n.jsxs)("form",{className:"fixed bottom-0 left-0 flex-col m-0 w-3/4 h-24 ",onSubmit:y.handleSubmit,children:[c&&(0,n.jsxs)("div",{className:"text-sm flex ",children:[(0,n.jsx)("div",{className:"mx-4",children:"＞＞".concat(c)}),(0,n.jsx)("button",{className:"mx-4 btn btn-xs btn-ghost",onClick:()=>m(),children:"clear"})]}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("textarea",{id:"content",name:"content",value:y.values.content,onChange:y.handleChange,onBlur:y.handleBlur,placeholder:"Comment",className:"block w-4/5 rounded-md border-0 m-2 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 pl-2",required:!0}),(0,n.jsx)("div",{className:"form-control mt-6",children:(0,n.jsx)("button",{type:"submit",className:"btn btn-xs btn-ghost",children:(0,n.jsx)(f.yhK,{size:20})})})]}),!i&&(0,n.jsx)("div",{className:"text-xs",children:"* you need to login to comment."})]})]})},O=r(5090),T=e=>{let{boardTitle:t}=e,r=(0,a.CG)(e=>e.loginUserSlice.account),[s,i]=(0,o.useState)(!1);return(0,n.jsxs)("header",{className:"bg-gradient-to-r from-gray-400 to-white fixed pt-2 top-0 left-0 right-0 z-10 h-14 flex w-full items-center justify-between p-2",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("button",{type:"button",className:"text-base asideOpen",children:(0,n.jsx)("a",{href:"/home",className:"link link-hover font-bold text-white",children:"Chat Board"})})}),(0,n.jsx)("div",{children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{type:"button",className:"badge badge-ghost",onClick:()=>{i(!s)},children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h7"})})}),(0,n.jsxs)("div",{className:"".concat(s?"":"hidden"," absolute right-2 mt-1 w-48 divide-y divide-gray-200 rounded-md border border-gray-200 bg-white shadow-md"),"x-show":"profileOpen","x-transition":"true",children:[(0,n.jsx)("div",{className:"flex flex-col space-y-3 p-1",children:(0,n.jsx)("div",{className:"text-sm transition hover:text-blue-600",children:r.username})}),(0,n.jsx)("div",{className:"p-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 transition hover:text-blue-600",children:[(0,n.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),(0,n.jsx)(O.Z,{})]})})]})]}):(0,n.jsx)("a",{href:"/login",className:"badge badge-ghost",children:"Login"})})]})},P=r(1399),L=e=>{let{board_id:t}=e,r=(0,d.useRouter)(),s=(0,a.TL)(),[i,l]=(0,o.useState)(!1),c=(0,a.CG)(e=>e.loginUserSlice.account),m=(0,a.CG)(e=>e.loginUserSlice.token),[h,g]=(0,o.useState)(Date.now()),x=j.Ry().shape({image:j.nK().test("fileType","Only image files are allowed",e=>!e||!!(e&&e.type&&["image/jpg","image/jpeg","image/png","image/gif","image/svg+xml"].includes(e.type)))}),[p,y]=(0,o.useState)({message:"",type:""}),v=(0,b.TA)({initialValues:{image:null},validationSchema:x,onSubmit:async e=>{if(null===e.image){y({message:"Image is necessary",type:"error"});return}try{if(c&&m){s((0,u.NH)(!0));let r=await N(t,e,m);l(!1),r.error?y({message:"Failed to create Image",type:"error"}):y({message:"Succeeded to create Image",type:"success"})}else r.push("/login")}catch(e){console.error("Post error:",e),y({message:"Failed to create image",type:"error"})}finally{s((0,u.NH)(!1))}}});return(0,o.useEffect)(()=>{l(!1)},[]),(0,n.jsxs)(n.Fragment,{children:[p.message&&(0,n.jsx)("div",{className:(0,w.Z)("fixed z-[100] top-5 right-5 w-fit text-white text-lg px-5 py-3 rounded-md mb-5 ",{"bg-red-500":"error"===p.type,"bg-green-500":"success"===p.type}),children:p.message}),(0,n.jsx)("div",{className:"flex justify-center fixed bottom-24",children:(0,n.jsx)("button",{className:"z-50 bg-gray-300 hover:bg-gray-400 text-xs text-black p-2 m-1 rounded  ",type:"button",onClick:()=>{if(!c||!m)return r.push("/login");l(!0)},children:(0,n.jsx)(P.H3h,{size:15})})}),i&&(0,n.jsx)("div",{className:"z-50 h-screen w-screen flex items-center justify-center bg-blue-100 bg-opacity-50 transform scale-100 transition-transform duration-300 ",children:(0,n.jsxs)("div",{className:"w-full fixed bottom-10 bg-white p-2 m-4 rounded",children:[(0,n.jsx)("div",{className:"flex justify-between",children:(0,n.jsx)("button",{className:"focus:outline-none",type:"button",onClick:()=>{l(!1)},children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})}),(0,n.jsxs)("form",{className:"w-full flex justify-between items-center",onSubmit:v.handleSubmit,encType:"multipart/form-data",children:[(0,n.jsxs)("div",{className:"flex flex-col justify-between",children:[(0,n.jsx)("div",{className:"form-control",children:(0,n.jsx)("input",{id:"image",type:"file",name:"image",className:(0,w.Z)("input input-bordered block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 pl-2",{"border-2 border-red-500 bg-red-100 text-red-800":v.touched.image&&v.errors.image}),onChange:e=>{let t=e.target.files&&e.target.files[0];t&&v.setFieldValue("image",t)},required:!0},h)}),v.errors.image&&v.touched.image&&(0,n.jsx)("p",{className:"text-red-500 ml-1 my-3",children:v.errors.image})]}),(0,n.jsx)("div",{className:"form-control mt-6",children:(0,n.jsx)("button",{type:"submit",className:"",children:(0,n.jsx)(f.yhK,{size:30})})})]})]})})]})},E=e=>{let{params:{id:t}}=e,r=(0,a.TL)(),i=(0,a.CG)(e=>e.reloadSlice.reloading),l=(0,a.CG)(e=>e.loginUserSlice.account),c=(0,a.CG)(e=>e.loginUserSlice.token),[d,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth");if(e.ok){let t=await e.json();r((0,y.hv)(t.account)),r((0,y.o4)(t.token))}else console.error("Failed to fetch login user"),r((0,y.hv)(null)),r((0,y.o4)(null))}catch(e){console.error("Error fetching login user from cookie:",e)}})()},[]),(0,o.useEffect)(()=>{m()},[l,c,i]);let m=async()=>{try{let e=await (0,s.K)(t);u(e.board)}catch(e){console.error("Error fetching data:",e)}finally{}};return(0,n.jsx)("div",{className:"flex flex-row justify-between border-b p-2 w-full",children:d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T,{boardTitle:d.title}),(0,n.jsx)(p,{boardTitle:d.title,boardAccountId:d.account.id,comments:d.comments}),(0,n.jsx)(L,{board_id:t}),(0,n.jsx)(C,{board_id:t})]})})}},5090:function(e,t,r){"use strict";var n=r(7437),o=r(2265),a=r(1841),s=r(7907),i=r(9683),l=r(3167);t.Z=()=>{let e=(0,a.TL)(),t=(0,s.useRouter)(),[r,c]=(0,o.useState)({message:"",type:""}),d=async()=>{try{c({message:"Logout processing",type:"load"}),(await fetch("/api/logout",{method:"DELETE"})).ok?(console.log("Logged out successfully"),document.cookie="loginId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="loginUsername=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="loginToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",e((0,i.hv)(null)),e((0,i.o4)(null)),t.push("/login")):(console.error("Failed to logout"),c({message:"Logout Failed!",type:"error"}))}catch(e){console.error("Error while logging out:",e),c({message:"Logout Failed!",type:"error"})}};return(0,n.jsxs)(n.Fragment,{children:[r.message&&(0,n.jsx)("div",{className:(0,l.Z)("fixed z-[100] top-5 right-5 w-fit text-white text-lg px-5 py-3 rounded-md mb-5 ",{"bg-red-500":"error"===r.type,"bg-green-500":"load"===r.type}),children:"load"===r.type?(0,n.jsxs)(n.Fragment,{children:[r.message,(0,n.jsx)("span",{className:"loading loading-dots loading-lg"})]}):(0,n.jsx)(n.Fragment,{children:r.message})}),(0,n.jsx)("button",{onClick:d,children:"Logout"})]})}},644:function(e,t,r){"use strict";r.d(t,{S:function(){return n}});let n="https://chat.taiseiyama.com/django"},4410:function(e,t,r){"use strict";r.d(t,{K:function(){return a},k:function(){return o}});var n=r(644);let o=async e=>{let t=await fetch("".concat(n.S,"/board/search/?keyword=").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});return await t.json()},a=async e=>{let t=await fetch("".concat(n.S,"/board/get/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});return await t.json()}},3136:function(e,t,r){"use strict";r.r(t);var n=r(7437),o=r(828),a=r(1841);t.default=e=>{let{children:t}=e;return(0,n.jsx)(o.zt,{store:a.w_,children:t})}},1841:function(e,t,r){"use strict";r.d(t,{w_:function(){return c},TL:function(){return d},CG:function(){return u}});var n=r(828),o=r(5972),a=r(9683),s=r(2251),i=r(6212),l=r(6674);r(3136);let c=(0,o.xC)({reducer:{loginUserSlice:a.ZP,reloadSlice:s.ZP,searchBoardResultSlice:i.ZP,commentReplySlice:l.ZP}}),d=n.I0,u=n.v9},6674:function(e,t,r){"use strict";r.d(t,{VH:function(){return o}});let n=(0,r(5972).oM)({name:"commentReplySlice",initialState:{commentReply:null},reducers:{setCommentReply(e,t){e.commentReply=t.payload}}}),{setCommentReply:o}=n.actions;t.ZP=n.reducer},9683:function(e,t,r){"use strict";r.d(t,{hv:function(){return o},o4:function(){return a}});let n=(0,r(5972).oM)({name:"loginUser",initialState:{account:null,token:null},reducers:{setAccount(e,t){e.account=t.payload},setToken(e,t){e.token=t.payload}}}),{setAccount:o,setToken:a}=n.actions;t.ZP=n.reducer},2251:function(e,t,r){"use strict";r.d(t,{NH:function(){return o},XX:function(){return a}});let n=(0,r(5972).oM)({name:"Reload",initialState:{reloading:!1,searchLoad:!1},reducers:{setReloading(e,t){e.reloading=t.payload},setSearchLoad(e,t){e.searchLoad=t.payload}}}),{setReloading:o,setSearchLoad:a}=n.actions;t.ZP=n.reducer},6212:function(e,t,r){"use strict";r.d(t,{mu:function(){return o}});let n=(0,r(5972).oM)({name:"searchBoardResult",initialState:{searchBoardResult:[],totalPages:1},reducers:{setSearchBoardResult(e,t){e.searchBoardResult=t.payload},setTotalPages(e,t){e.totalPages=t.payload}}}),{setSearchBoardResult:o,setTotalPages:a}=n.actions;t.ZP=n.reducer},158:function(e,t,r){"use strict";r.d(t,{w_:function(){return d}});var n=r(2265),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=n.createContext&&n.createContext(o),s=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var n,o;n=t,o=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e){return t=>n.createElement(u,i({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,c({key:r},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var r,{attr:o,size:a,title:l}=e,d=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,s),u=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,d,{className:r,style:c(c({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==a?n.createElement(a.Consumer,null,e=>t(e)):t(o)}}},function(e){e.O(0,[950,706,699,614,274,181,971,69,744],function(){return e(e.s=4941)}),_N_E=e.O()}]);